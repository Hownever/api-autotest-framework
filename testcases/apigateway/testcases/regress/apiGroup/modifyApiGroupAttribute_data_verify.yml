- config:
    name: 修改API分组信息，验证数据修改成功
    variables:
        serviceLine_apim: apigateway
        regionId_apim_1: cn-south-1
        groupName: JIASHUO_MODIFY_APIG
        authType: jd_cloud
        description: 创建分组
        prefix: AAA
        prefixStrip: 0
        groupType: api_group
        keyCheck: check_exist
        filters1: groupName
        filters1values: JIASHUO_MODIFY_APIG

        groupName_new: JIASHUO_MODIFY_APIG_NEW
        authType_new: None
        description_new: 修改API分组信息，验证数据修改成功
        prefix_new: BBB
        prefixStrip_new: 1
        keyCheck_new: no_check_exist
        filters1values_new: JIASHUO_MODIFY_APIG_NEW
    verify: False

- test:
    name: 删除旧数据：删除旧的API分组
    testcase: testcases/regress/setup/prepare_for_createApiGroup.yml
    variables:
        serviceLine_pcag: $serviceLine_apim
        regionId_apim_pcag: $regionId_apim_1
        filters1_pcag: $filters1
        filters1values_pcag: $filters1values

- test:
    name: 删除旧数据：删除旧的API分组
    testcase: testcases/regress/setup/prepare_for_createApiGroup.yml
    variables:
        serviceLine_pcag: $serviceLine_apim
        regionId_apim_pcag: $regionId_apim_1
        filters1_pcag: $filters1
        filters1values_pcag: $filters1values_new

- test:
    name: 创建分组成功，分组名：$groupName
    api: api/apiGroup/createApiGroup.yml
    variables:
        regionId_cag: $regionId_apim_1
        groupName_cag: $groupName
        description_cag: $description
        authType_cag: $authType
        prefix_cag: $prefix
        prefixStrip_cag: $prefixStrip
        groupType_cag: $groupType
    extract:
        - apiGroupId_cag: content.result.apiGroupId
        - revision_cag: content.result.revision
    validate:
        - eq: ["status_code", 200]
        - len_eq: [$apiGroupId_cag, 15]
        - eq: [$revision_cag, 0.0.1]
        - contains: [$apiGroupId_cag, ag-]
    output:
        - apiGroupId_cag
        - revision_cag

- test:
    name: 查询分组，和创建的参数一致
    api: api/apiGroup/describeApiGroup.yml
    variables:
        apiGroupId_descag: $apiGroupId_cag
        regionId_descag: $regionId_apim_1
    validate:
        - eq: ["status_code", 200]
        - eq: [content.result.apiGroup.apiGroupId, $apiGroupId_cag]
        - eq: [content.result.apiGroup.authType, $authType]
        - eq: [content.result.apiGroup.description, $description]
        - eq: [content.result.apiGroup.groupName, $groupName]
        - eq: [content.result.apiGroup.groupType, $groupType]
        - eq: [content.result.apiGroup.keyCheck, $keyCheck]
        - eq: [content.result.apiGroup.prefix, $prefix]
        - eq: [content.result.apiGroup.prefixStrip, $prefixStrip]
        - eq: [content.result.apiGroup.regionId, $regionId_apim_1]
        - eq: [content.result.apiGroup.revision, $revision_cag]
        - eq:
            - content.result.apiGroup.domain
            - ${return_string($apiGroupId_cag, env=online, host=1, regionId=$regionId_apim_1)}

- test:
    name: 修改分组信息
    api: api/apiGroup/modifyApiGroupAttribute.yml
    variables:
        apiGroupId_maga: $apiGroupId_cag
        regionId_maga: $regionId_apim_1
        groupName_maga: $groupName_new
        description_maga: $description_new
        authType_maga: $authType_new
        prefix_maga: $prefix_new
        prefixStrip_maga: $prefixStrip_new
        keyCheck_maga: $keyCheck_new
    validate:
        - eq: ["status_code", 200]

- test:
    name: 查询分组，和修改的参数一致
    api: api/apiGroup/describeApiGroup.yml
    variables:
        apiGroupId_descag: $apiGroupId_cag
        regionId_descag: $regionId_apim_1
    validate:
        - eq: ["status_code", 200]
        - eq: [content.result.apiGroup.apiGroupId, $apiGroupId_cag]
        - eq: [content.result.apiGroup.authType, $authType_new]
        - eq: [content.result.apiGroup.description, $description_new]
        - eq: [content.result.apiGroup.groupName, $groupName_new]
        - eq: [content.result.apiGroup.keyCheck, $keyCheck_new]
        - eq: [content.result.apiGroup.prefix, $prefix_new]
        - eq: [content.result.apiGroup.prefixStrip, $prefixStrip_new]
        - eq: [content.result.apiGroup.regionId, $regionId_apim_1]
        - eq: [content.result.apiGroup.revision, $revision_cag]
        - eq:
            - content.result.apiGroup.domain
            - ${return_string($apiGroupId_cag, env=online, host=1, regionId=$regionId_apim_1)}

- test:
    name: 删除旧数据：删除旧的API分组
    testcase: testcases/regress/setup/prepare_for_createApiGroup.yml
    variables:
        serviceLine_pcag: $serviceLine_apim
        regionId_apim_pcag: $regionId_apim_1
        filters1_pcag: $filters1
        filters1values_pcag: $filters1values