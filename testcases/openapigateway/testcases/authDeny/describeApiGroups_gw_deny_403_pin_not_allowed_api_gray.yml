- config:
    name: 调用describeApiGroups接口，网关拦截，报错信息 pin is not allowed in api gray
    variables:
        product: ${ENV(ENV_PRODUCT)}
        apiVersion: ${ENV(ENV_API_VERSION)}
        openapi_yaml: ${ENV(ENV_OPENAPI_SWAGGER_FILE_PATH)}
        regionId: ${ENV(ENV_DEFAULT_REGIONID)}
        api_ver: ${ENV(ENV_API_VERSION)}
        result: "网关拦截，报错信息 pin is not allowed in api gray"
        serviceLine: apigateway
        apis: describeApiGroups
        ser_ver_api: apigateway-v1-describeApiGroups
        openapi_manage_host: ${ENV(ENV_OPENAPI_INNER_MANAGE_HOST)}
        openapi_data_host: ${ENV(ENV_OPENAPI_INNER_DATA_HOST)}
        serviceLinePin: jiashuo-stag
        apisPin: jiashuo-stag
        userinfo:
            prepareinfo: bbb
            info: aaa
            serviceLineFlag: True
            serviceLinePinFlag: True
            apisFlag: True
            apisPinFlag: False
            pin:
            AK: ${ENV(ENV_USER_AK)}
            SK: ${ENV(ENV_USER_SK)}
    verify: False

- test:
    name: ${get_value_from_userinfo($userinfo, prepareinfo)}
    testcase: testcases/authAllow/prepare_for_gray_test.yml
    variables:
        openapi_manage_host: $openapi_manage_host
        serviceLine: $serviceLine
        serviceLineFlag: ${get_value_from_userinfo($userinfo, serviceLineFlag)}
        serviceLinePin: $serviceLinePin
        serviceLinePinFlag: ${get_value_from_userinfo($userinfo, serviceLinePinFlag)}
        ser_ver_api: $ser_ver_api
        apis: $apis
        apisFlag: ${get_value_from_userinfo($userinfo, apisFlag)}
        apisPin: $apisPin
        apisPinFlag:  ${get_value_from_userinfo($userinfo, apisPinFlag)}

- test:
    name: ${get_value_from_userinfo($userinfo, info)}调用接口$apis，$result
    api: api/describeApiGroups.yml
    variables:
        host: $openapi_data_host
        header: ${get_value_from_userinfo($userinfo, header)}
        AK: ${get_value_from_userinfo($userinfo, AK)}
        SK: ${get_value_from_userinfo($userinfo, SK)}
        filters1:
        filters1values:
        sleeptime: 15
    extract:
        - scode: status_code
        - requestId: content.requestId
        - error_message: content.error.message
        - error_status: content.error.status
    validate:
        - eq: [$scode, 403]
        - eq: [$error_status, HTTP_FORBIDDEN]
        - eq: [$error_message, "pin is not allowed in api gray [gw]"]
        - len_eq: [$requestId, 32]