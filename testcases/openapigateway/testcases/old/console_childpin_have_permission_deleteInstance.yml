- config:
    name: console_childpin_have_permission_deleteInstance.yml
    variables:
        - regionId: ${ENV(regionId)}
        - exist_child_pin_have_permission: ${ENV(exist_child_pin_have_permission)}
        - openapiGwUrl: ${ENV(openapiGwUrl)}
        - domain: ${ENV(domain)}
        - access_key_console: ${ENV(access_key_console)}
        - secret_key_console: ${ENV(secret_key_console)}

- test:
    name:  控制台aksk，传存在的子账户pin，调用有权限的外部接口deleteInstance，请求通过
    request:
        url: /v1/regions/$regionId/instances/tancong
        method: DELETE
        headers:
            Content-Type: application/json
            x-jdcloud-pin: $exist_child_pin_have_permission
        params: ~
    setup_hooks:
        - ${update_JD_headers($request, $openapiGwUrl, None, vm, $access_key_console, $secret_key_console, $regionId)}
    extract:
        - scode: status_code
        - requestId: content.requestId
        - error_message: content.error.message
        - error_status: content.error.status
    validate:
        - eq: [$scode, 404]
        - eq: [$error_status, NOT_FOUND]
        - contains: [$error_message, "not found"]
        - len_eq: [$requestId, 32]
