- config:
    name: normal_main_no_pin_internal_ConvertImage.yml
    variables:
        - regionId: ${ENV(regionId)}
        - exist_main_pin: ${ENV(exist_main_pin)}
        - openapiGwUrl: ${ENV(openapiGwUrl_vm_external)}
        - domain: ${ENV(domain)}
        - access_key: ${ENV(access_key_normal_main)}
        - secret_key: ${ENV(secret_key_normal_main)}

- test:
    name: 普通用户aksk，不传pin，调用内部接口convertImage，调用成功，后端报错403
    request:
        url: /v1/regions/$regionId/images/tancong:convertImage
        method: POST
        headers:
            Content-Type: application/json
        params: ~
    setup_hooks:
        - ${update_JD_headers($request, $openapiGwUrl, None, vm, $access_key, $secret_key, $regionId)}
    extract:
        - scode: status_code
        - requestId: content.requestId
        - error_message: content.error.message
        - error_status: content.error.status
    validate:
        - eq: [$scode, 403]
        - eq: [$error_status, HTTP_FORBIDDEN]
        - eq: [$error_message, "this api is not allowed [gw]"]
        - len_eq: [$requestId, 32]
